## 1. 단방향 연관관계

---

### [예제 시나리오]

- 회원과 팀이 있다.
    - 회원 스키마
        - Id
        - teamId (FK)
        - username
    - 팀 스키마
        - id
        - name
- 회원은 하나의 팀에만 소속될수 있다.
- 회원과 팀은 다대일 관계이다.

### [예제 결론]

- 객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없다.
- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 찾는다.
- 객체는 참조를 사용해서 연관된 객체를 찾는다.

### [단방향 연관관계]

- 필드에 참조형으로 선언
- @ManyToOne, @OneToOne등의 어노테이션 추가 (연관관계 타입 설정)
- @JoinCloumn 어노테이션을 지정하여 대상 컬럼 지정 (name 파라미터로 직접 설정 가능)

## 2. 양방향 연관관계

---

### [방법]

- 일대다에서 다의 엔티티에 @ManyToOne지정
    - @Column 어노테이션으로 FK 명시적으로 지정
- @OneToMany
    - mappedBy로 상대 엔티티의 필드명 명시

### [객체 참조와 외래키의 차이]

**객체**

- Entity에서는 참조형 필드를 선언하여 양방향 연관관계를 설정할 수 있음
- **객체의 양방향 관계는 사실 양방향이 아니라, 서로 다른 단방향 관계 2개이다.**

**테이블**

- **외래키 하나로 두 테이블의 연관관계를 관리한다.**
- 테이블에서는 JOIN 쿼리를 발행하기만 하면되기 때문에 따로 설정할 필요가 없음

만약, Member의 소속된 Team을 변경해야한다면, Team 객체를 변경해야할까 아니면 Member의 Team을 변경해야할까?

### [연관관계의 주인]

**양방향 맵핑 규칙**

- 객체의 두 관계중 하나를 연관관계의 주인으로 지정한다.
- **연관관계의 주인만이 외래키를 관리(등록, 수정)**
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성을 사용할 수 없다.
- 주인이 아니면 mappeedBy 속성으로 주인을 지정한다.

**누구를 주인으로 할까?**

- FK가 있는곳을 주인으로 설정한다. (권장)
    - 만약 Team을 주인으로 설정한다면, 해당 팀의 member가 변경되면, MEMBER table에 update 쿼리가 나간다…

**주의**

- 순수한 객체간의 관계를 생각해야한다.
    - 양방향 맵핑 시, 연관관계의 주인에 값을 입력해야한다
    - 또한, 연관관계의 주인이 아니더라도, (ex Team.members의 각 멤버) 각각의 객체에 값을 입력해주어야 한다.
- 연관관계 편의 메서드를 생성해야한다.
- 양방향 맵핑 시, 무한 루프를 조심해야한다.
    - toString, lombok, JSON 라이브러리
- Fetch - Join

### [정리]

- 단방향 맵핑만으로도 이미 연관관계 설정은 완료되었다.
- 양방향 맵핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가된것 뿐
- JPQL에서 역뱡향으로 탐색할 일이 많음
- 단방향 맵핑을 잘 하고, 양방향은 필요할 때 추가해도 된다.

  (테이블에 영향을 주지 않음)

- 비즈니스 로직을 기준으로 연관관계의 주인을 선택하지 말고, **외래키의 위치를 기준으로 정해야한다.**